{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Figures Ocean Solutions paper\"\nauthor: \"Jean-Pierre Gattuso\"\ndate: '`r format(Sys.Date(), \"%d %B %Y\")`'\noutput:\n  html_document:\n    code_folding: hide\n    fig_caption: yes\n    toc: yes\n    toc_float: yes\n  pdf_document:\n    toc: yes\n---\n\n\n```{r prep, echo=FALSE, message= FALSE}\nrm(list = ls())\nlibrary(tidyverse)\nlibrary(readxl)\nlibrary(knitr)       # kable : prettier data.frame output\nlibrary(viridis)\nlibrary(gridExtra)\nSys.setlocale(\"LC_ALL\", \"en_US.UTF-8\")\nSys.setenv(TZ='UTC') # on utilise UTC\n```\n\n```{r prepare data, warning=FALSE, echo=FALSE, message= FALSE}\n# First three effectivenesseses\ndat1 <- read_xlsx(\"../../interim_documents/backups_google_docs/Ocean Solutions Tables_2017-05-13d.xlsx\",\n                 skip=17, n_max = 75, trim_ws = TRUE,\n                 sheet = \"T3_Systems-Ocean\", col_names = TRUE,\n                 col_types = \"text\") %>%\n  dplyr::select(-`Assessment guidance`) %>%\n  dplyr::filter(grepl(\"Effectiveness to mimise impacts from\", Criteria)) %>%\n  mutate_each(funs(as.integer), 3:18)\ncolnames(dat1) <- c(\"Category\", \"Criteria\", \"Renewables\", \"Vegetation (g)\", \"Productivity\",\n                   \"Alkalinity (g)\",\"Others\", \"Cloud\", \"Albedo\", \"Alkalinity (l)\",\n                   \"Vegetation (l)\", \"Pollutants\", \"Hydrology\", \"Overexploitation\",\n                   \"Protection\", \"Invasion\", \"Evolution\",\n                   \"Relocation & Restoration\")\ndat1\ndat1$Criteria[dat1$Criteria == \"Effectiveness to mimise impacts from warming (T1a or T1b with T2)\"] <-  \"OW\"\ndat1$Criteria[dat1$Criteria == \"Effectiveness to mimise impacts from ocean acidification (T1a or T1b with T2)\"] <-  \"OA\"\ndat1$Criteria[dat1$Criteria == \"Effectiveness to mimise impacts from sea level rise (T1a or T1b with T2)\"] <-  \"SLR\"\n\n# Next three rows (need to extract scores)\ndat2 <- read_xlsx(\"../../interim_documents/backups_google_docs/Ocean Solutions Tables_2017-05-13d.xlsx\",\n                 skip=17, n_max = 75, trim_ws = TRUE,\n                 sheet = \"T3_Systems-Ocean\", col_names = TRUE,\n                 col_types = \"text\") %>%\n  dplyr::select(-`Assessment guidance`) %>%\n  dplyr::filter(grepl(\"other drivers|co-benefits|Unintended consequences\", Criteria)) %>%\n  mutate_each(funs(substr(., 1, 1)), 3:18) %>%\n  mutate_each(funs(as.integer), 3:18)\ncolnames(dat2) <- c(\"Category\", \"Criteria\", \"Renewables\", \"Vegetation (g)\", \"Productivity\",\n                   \"Alkalinity (g)\",\"Others\", \"Cloud\", \"Albedo\", \"Alkalinity (l)\",\n                   \"Vegetation (l)\", \"Pollutants\", \"Hydrology\", \"Overexploitation\",\n                   \"Protection\", \"Invasion\", \"Evolution\",\n                   \"Relocation & Restoration\")\ndat2$Criteria[dat2$Criteria == \"Effectiveness of solution to reduce impacts on an ecosystem by reducing other drivers (=previous effectiveness)\"] <-  \"Other\\ndrivers\"\ndat2$Criteria[dat2$Criteria == \"Importance of co-benefits on function and services of this habitat (=previous criterion)\"] <-  \"Co-benefits\"\ndat2$Criteria[dat2$Criteria == \"Unintended consequences  (0 loss of benefits or negative impact, >0 some benefits remain, 5 all benefits remain)\"] <-  \"Unintended\\nconsequences\"\n\n#  tidyr::separate(data = dat2, col = Renewables, into = c(\"A\", \"B\"), \n#                sep = \"(\")\n\n# bind and long form\ndat <- rbind(dat1, dat2)\ndat_long <- gather(data = dat, key = Solution, value = score, 3:18) %>%\n  dplyr::mutate(Solution = factor(Solution, levels = unique(as.character(Solution)))) %>%\n    dplyr::mutate(Criteria = factor(Criteria, levels = unique(as.character(Criteria))))\n```\n\n```{r plot effectiveness, echo=FALSE, message= FALSE}\nfig_t3 <- ggplot(data = dat_long, \n             aes(y=Solution, \n                 x=Criteria, fill=as.factor(score))) +\n  labs(x = NULL, y = NULL, title = \"Effectiveness of each solution to minimize risks of impacts from\\nocean warming (OW) and acidification (OA), and sea level rise (SLR)\") +\n  geom_tile(color=\"white\", size=0.1) +\n  scale_fill_viridis(alpha = 1,\n                     option = \"plasma\",\n                     direction = -1,\n                     name = NULL, \n                     discrete = TRUE,\n                     labels = c(\"Nil\", \"Very low\", \"Low\", \"Moderate\", \n                                \"High\", \"Very high\", \"Not applicable\")) +\n  facet_wrap(~Category, ncol=3) +\n  coord_fixed(ratio = 0.3) +\n  guides(fill = guide_legend(reverse = TRUE)) +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\nggsave(filename = \"fig_t3.pdf\", plot = fig_t3)\n```\n",
    "created" : 1494698324249.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "230725760",
    "id" : "1CE596BF",
    "lastKnownWriteTime" : 1494749849,
    "last_content_update" : 1494750148940,
    "path" : "~/Dropbox/Documents/publications/publications_inpreparation/gattuso_etal_ocean_solutions/displays/figs/2017-05-13_figs_tosi.Rmd",
    "project_path" : "2017-05-13_figs_tosi.Rmd",
    "properties" : {
        "chunk_output_type" : "inline",
        "tempName" : "Untitled1"
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}